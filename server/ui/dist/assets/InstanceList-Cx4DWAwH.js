import{i as M}from"./index-UDkyn1f5.js";import{a as K}from"./nodegroup-Zn-xeRGr.js";import{_ as T,f as O,s as F,a as E}from"./StatusTag.vue_vue_type_script_setup_true_lang-DvcO_2SW.js";import{d as Q,r as b,o as X,c as _,a as Y,b as a,w as t,e as i,E as h,F as I,i as k,h as V,t as Z,u as C,j as f,n as ee}from"./index-C-CE9rO1.js";function ae(S){return M.get("/nodegroup/instance",{params:S})}function le(S){return M.post("/nodegroup/instance",S)}const te={class:"page-container"},re=Q({__name:"InstanceList",setup(S){const D=["Pending","Creating","Created","Joined","Running","PendingDeletion","Deleting","Deleted"],G=["Init","InProcess","Success","Failed","Unknown"],x=b([]),N=b([]),w=b(!1),o=b({nodegroup:"",stage:"",status:"",searchType:"id",keyword:""}),s=b({page:1,pageSize:20,total:0}),u=b({id:"",nodeGroupId:"",name:"",ip:"",stage:"",status:""}),z=async()=>{s.value.page=1,await y()},R=async()=>{try{s.value.page=1,await y()}catch(n){console.error("筛选失败:",n)}},B=async()=>{o.value={nodegroup:"",stage:"",status:"",searchType:"id",keyword:""},s.value.page=1,await y()},$=async n=>{s.value.pageSize=n,s.value.page=1,await y()},j=async n=>{s.value.page=n,await y()},L=n=>{u.value={id:n.id,nodeGroupId:n.nodeGroupId,name:n.name||"",ip:n.ip||"",stage:n.stage,status:n.status},w.value=!0},A=async()=>{try{await le([{nodeGroupId:u.value.nodeGroupId,id:u.value.id,stage:u.value.stage,status:u.value.status}]),h.success("保存成功"),w.value=!1,await P()}catch(n){h.error(`保存失败: ${n.message||n}`)}},J=()=>{u.value={id:"",nodeGroupId:"",name:"",ip:"",stage:"",status:""}},y=async()=>{try{const n={};if(o.value.nodegroup&&(n.nodegroup=o.value.nodegroup),o.value.stage&&(n.stage=o.value.stage),o.value.status&&(n.status=o.value.status),o.value.keyword){const r=o.value.keyword.trim();n[o.value.searchType]=r}const p=(await ae(n)).data.data||[],m=new Map;x.value.forEach(r=>{r.instances&&Array.isArray(r.instances)&&r.instances.forEach(U=>{m.set(U.id,r.id)})});const d=p.map(r=>({...r,nodeGroupId:m.get(r.id)||"未知"}));s.value.total=d.length;const v=(s.value.page-1)*s.value.pageSize,c=v+s.value.pageSize;N.value=d.slice(v,c)}catch(n){console.error("加载 Instances 失败:",n),h.error("加载 Instances 失败")}},P=async()=>{try{const n=await K();x.value=n.data.data||[],await y({})}catch(n){console.error("加载数据失败:",n),h.error("加载数据失败")}};return X(()=>{P()}),(n,l)=>{const p=i("el-option"),m=i("el-select"),d=i("el-form-item"),v=i("el-input"),c=i("el-button"),r=i("el-form"),U=i("el-card"),g=i("el-table-column"),W=i("el-table"),q=i("el-pagination"),H=i("el-dialog");return f(),_("div",te,[l[19]||(l[19]=Y("h2",{style:{"margin-bottom":"20px"}},"Instance 管理",-1)),a(U,{shadow:"never",style:{"margin-bottom":"20px"}},{default:t(()=>[a(r,{inline:!0,model:o.value},{default:t(()=>[a(d,{label:"NodeGroup"},{default:t(()=>[a(m,{modelValue:o.value.nodegroup,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value.nodegroup=e),placeholder:"全部",clearable:"",style:{width:"200px"},onChange:z},{default:t(()=>[(f(!0),_(I,null,k(x.value,e=>(f(),ee(p,{key:e.id,label:e.id,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"Stage"},{default:t(()=>[a(m,{modelValue:o.value.stage,"onUpdate:modelValue":l[1]||(l[1]=e=>o.value.stage=e),placeholder:"全部",clearable:"",style:{width:"150px"},onChange:z},{default:t(()=>[(f(),_(I,null,k(D,e=>a(p,{key:e,label:C(F)[e],value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"Status"},{default:t(()=>[a(m,{modelValue:o.value.status,"onUpdate:modelValue":l[2]||(l[2]=e=>o.value.status=e),placeholder:"全部",clearable:"",style:{width:"150px"},onChange:z},{default:t(()=>[(f(),_(I,null,k(G,e=>a(p,{key:e,label:C(E)[e],value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"搜索"},{default:t(()=>[a(v,{modelValue:o.value.keyword,"onUpdate:modelValue":l[4]||(l[4]=e=>o.value.keyword=e),placeholder:"请输入搜索内容",clearable:"",style:{width:"300px"}},{prepend:t(()=>[a(m,{modelValue:o.value.searchType,"onUpdate:modelValue":l[3]||(l[3]=e=>o.value.searchType=e),style:{width:"90px"}},{default:t(()=>[a(p,{label:"ID",value:"id"}),a(p,{label:"Name",value:"name"}),a(p,{label:"IP",value:"ip"})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),a(d,null,{default:t(()=>[a(c,{type:"primary",onClick:R},{default:t(()=>[...l[14]||(l[14]=[V("查询",-1)])]),_:1}),a(c,{onClick:B},{default:t(()=>[...l[15]||(l[15]=[V("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(W,{data:N.value,style:{width:"100%"},border:""},{default:t(()=>[a(g,{prop:"id",label:"Instance ID",width:"120",align:"center"}),a(g,{prop:"name",label:"Name",width:"250",align:"center"}),a(g,{prop:"ip",label:"IP",width:"120",align:"center"}),a(g,{label:"Stage",width:"100",align:"center"},{default:t(({row:e})=>[a(T,{value:e.stage,type:"stage"},null,8,["value"])]),_:1}),a(g,{label:"Status",width:"100",align:"center"},{default:t(({row:e})=>[a(T,{value:e.status,type:"status"},null,8,["value"])]),_:1}),a(g,{prop:"providerID",label:"Provider ID","min-width":"200",align:"center"}),a(g,{label:"更新时间",width:"180",align:"center"},{default:t(({row:e})=>[V(Z(C(O)(e.updateTime)),1)]),_:1}),a(g,{label:"操作",width:"120",align:"center",fixed:"right"},{default:t(({row:e})=>[a(c,{type:"primary",size:"small",onClick:ne=>L(e)},{default:t(()=>[...l[16]||(l[16]=[V("编辑",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),a(q,{"current-page":s.value.page,"onUpdate:currentPage":l[5]||(l[5]=e=>s.value.page=e),"page-size":s.value.pageSize,"onUpdate:pageSize":l[6]||(l[6]=e=>s.value.pageSize=e),"page-sizes":[10,20,50,100],total:s.value.total,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px","justify-content":"flex-end"},onSizeChange:$,onCurrentChange:j},null,8,["current-page","page-size","total"]),a(H,{modelValue:w.value,"onUpdate:modelValue":l[13]||(l[13]=e=>w.value=e),title:"编辑 Instance",width:"600px",onClose:J},{footer:t(()=>[a(c,{onClick:l[12]||(l[12]=e=>w.value=!1)},{default:t(()=>[...l[17]||(l[17]=[V("取消",-1)])]),_:1}),a(c,{type:"primary",onClick:A},{default:t(()=>[...l[18]||(l[18]=[V("保存",-1)])]),_:1})]),default:t(()=>[a(r,{model:u.value,"label-width":"120px"},{default:t(()=>[a(d,{label:"Instance ID"},{default:t(()=>[a(v,{modelValue:u.value.id,"onUpdate:modelValue":l[7]||(l[7]=e=>u.value.id=e),disabled:""},null,8,["modelValue"])]),_:1}),a(d,{label:"Name"},{default:t(()=>[a(v,{modelValue:u.value.name,"onUpdate:modelValue":l[8]||(l[8]=e=>u.value.name=e),disabled:""},null,8,["modelValue"])]),_:1}),a(d,{label:"IP"},{default:t(()=>[a(v,{modelValue:u.value.ip,"onUpdate:modelValue":l[9]||(l[9]=e=>u.value.ip=e),disabled:""},null,8,["modelValue"])]),_:1}),a(d,{label:"Stage"},{default:t(()=>[a(m,{modelValue:u.value.stage,"onUpdate:modelValue":l[10]||(l[10]=e=>u.value.stage=e),style:{width:"100%"}},{default:t(()=>[(f(),_(I,null,k(D,e=>a(p,{key:e,label:C(F)[e],value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"Status"},{default:t(()=>[a(m,{modelValue:u.value.status,"onUpdate:modelValue":l[11]||(l[11]=e=>u.value.status=e),style:{width:"100%"}},{default:t(()=>[(f(),_(I,null,k(G,e=>a(p,{key:e,label:C(E)[e],value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{re as default};
