import{s as N,p as Y}from"./public-api-BJq2-jLc.js";import{a as q,u as F,c as P}from"./nodegroup-Zn-xeRGr.js";import{d as H,r as u,o as J,c as K,a as V,b as a,w as o,e as r,E as p,h as s,n as Q,p as R,q as W,j as I}from"./index-C-CE9rO1.js";import"./index-UDkyn1f5.js";const X={class:"page-container"},Z={style:{"margin-bottom":"20px"}},oe=H({__name:"NodeGroupList",setup(h){const G=u([]),x=u(!1),g=u({autoscalingOptionsYaml:"",nodeTemplateYaml:""}),c=u(!1),d=u(""),m=u(""),k=u(null),y=u(!1),v=u("increase"),n=u({nodeGroupId:"",currentSize:0,delta:1}),_=l=>{g.value={autoscalingOptionsYaml:l.autoscalingOptions?N(l.autoscalingOptions):"# 未配置",nodeTemplateYaml:l.nodeTemplate?N(l.nodeTemplate):"# 未配置"},x.value=!0},$=()=>{try{d.value.trim()&&Y(d.value),m.value=""}catch(l){m.value=`YAML 格式错误: ${l.message}`}},D=l=>{k.value=l,d.value=N(l),m.value="",c.value=!0},M=async()=>{if(m.value){p.error("YAML 格式错误，请检查后重试");return}if(!d.value.trim()){p.warning("请输入配置内容");return}try{const l=Y(d.value);if(!l.id){p.error("NodeGroup ID 不能为空");return}await F(l),p.success("保存成功"),c.value=!1,await z()}catch(l){p.error(`保存失败: ${l.message||l}`)}},U=()=>{d.value="",m.value="",k.value=null},T=(l,e)=>{v.value=e,n.value={nodeGroupId:l.id,currentSize:l.targetSize||0,delta:1},y.value=!0},B=async()=>{try{const l=v.value==="increase"?n.value.delta:-n.value.delta;await W.confirm(`确定要${v.value==="increase"?"增加":"减少"} ${n.value.delta} 个节点吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await P(n.value.nodeGroupId,l),p.success("操作成功"),y.value=!1,await z()}catch(l){l!=="cancel"&&p.error(`操作失败: ${l.message||l}`)}},O=()=>{n.value={nodeGroupId:"",currentSize:0,delta:1}},z=async()=>{try{const{data:l}=await q();G.value=l.data||[]}catch(l){console.error("加载 NodeGroup 失败:",l),p.error("加载 NodeGroup 失败")}};return J(()=>{z()}),(l,e)=>{const f=r("el-table-column"),i=r("el-button"),E=r("el-table"),b=r("el-input"),C=r("el-dialog"),A=r("el-alert"),w=r("el-form-item"),L=r("el-input-number"),j=r("el-form");return I(),K("div",X,[e[23]||(e[23]=V("h2",{style:{"margin-bottom":"20px"}},"NodeGroup 管理",-1)),a(E,{data:G.value,style:{width:"100%",height:"calc(100vh - 150px)"},border:""},{default:o(()=>[a(f,{prop:"id",label:"ID","min-width":"200"}),a(f,{prop:"minSize",label:"MinSize","min-width":"100",align:"center"}),a(f,{prop:"maxSize",label:"MaxSize","min-width":"100",align:"center"}),a(f,{prop:"targetSize",label:"TargetSize","min-width":"120",align:"center"}),a(f,{prop:"instanceParameter",label:"Instance 参数","min-width":"200"}),a(f,{label:"操作","min-width":"150",align:"center",fixed:"right"},{default:o(({row:t})=>[a(i,{type:"success",size:"small",onClick:S=>T(t,"increase")},{default:o(()=>[...e[12]||(e[12]=[s("+",-1)])]),_:1},8,["onClick"]),a(i,{type:"warning",size:"small",onClick:S=>T(t,"decrease")},{default:o(()=>[...e[13]||(e[13]=[s("-",-1)])]),_:1},8,["onClick"]),a(i,{type:"info",size:"small",onClick:S=>_(t)},{default:o(()=>[...e[14]||(e[14]=[s("详情",-1)])]),_:1},8,["onClick"]),a(i,{type:"primary",size:"small",onClick:S=>D(t)},{default:o(()=>[...e[15]||(e[15]=[s("编辑",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),a(C,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=t=>x.value=t),title:"NodeGroup 详细信息",width:"900px",draggable:""},{footer:o(()=>[a(i,{onClick:e[2]||(e[2]=t=>x.value=!1)},{default:o(()=>[...e[18]||(e[18]=[s("关闭",-1)])]),_:1})]),default:o(()=>[V("div",Z,[e[16]||(e[16]=V("h3",{style:{"margin-bottom":"10px"}},"AutoscalingOptions",-1)),a(b,{modelValue:g.value.autoscalingOptionsYaml,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value.autoscalingOptionsYaml=t),type:"textarea",rows:5,readonly:"",style:{"font-family":"'Courier New', monospace","font-size":"13px"}},null,8,["modelValue"])]),V("div",null,[e[17]||(e[17]=V("h3",{style:{"margin-bottom":"10px"}},"NodeTemplate",-1)),a(b,{modelValue:g.value.nodeTemplateYaml,"onUpdate:modelValue":e[1]||(e[1]=t=>g.value.nodeTemplateYaml=t),type:"textarea",rows:15,readonly:"",style:{"font-family":"'Courier New', monospace","font-size":"13px"}},null,8,["modelValue"])])]),_:1},8,["modelValue"]),a(C,{modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=t=>c.value=t),title:"编辑 NodeGroup",width:"700px",onClose:U},{footer:o(()=>[a(i,{onClick:e[5]||(e[5]=t=>c.value=!1)},{default:o(()=>[...e[19]||(e[19]=[s("取消",-1)])]),_:1}),a(i,{type:"primary",disabled:!!m.value,onClick:M},{default:o(()=>[...e[20]||(e[20]=[s("保存",-1)])]),_:1},8,["disabled"])]),default:o(()=>[m.value?(I(),Q(A,{key:0,title:m.value,type:"error",closable:!1,style:{"margin-bottom":"15px"}},null,8,["title"])):R("",!0),a(b,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=t=>d.value=t),type:"textarea",rows:20,placeholder:"请输入 YAML 格式的 NodeGroup 配置",style:{"font-family":"'Courier New', monospace","font-size":"13px"},onInput:$},null,8,["modelValue"])]),_:1},8,["modelValue"]),a(C,{modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=t=>y.value=t),title:v.value==="increase"?"增加节点":"减少节点",width:"500px",onClose:O},{footer:o(()=>[a(i,{onClick:e[10]||(e[10]=t=>y.value=!1)},{default:o(()=>[...e[21]||(e[21]=[s("取消",-1)])]),_:1}),a(i,{type:v.value==="increase"?"success":"warning",onClick:B},{default:o(()=>[...e[22]||(e[22]=[s(" 确定 ",-1)])]),_:1},8,["type"])]),default:o(()=>[a(j,{model:n.value,"label-width":"120px"},{default:o(()=>[a(w,{label:"NodeGroup ID"},{default:o(()=>[a(b,{modelValue:n.value.nodeGroupId,"onUpdate:modelValue":e[7]||(e[7]=t=>n.value.nodeGroupId=t),disabled:""},null,8,["modelValue"])]),_:1}),a(w,{label:"当前 TargetSize"},{default:o(()=>[a(b,{modelValue:n.value.currentSize,"onUpdate:modelValue":e[8]||(e[8]=t=>n.value.currentSize=t),disabled:""},null,8,["modelValue"])]),_:1}),a(w,{label:v.value==="increase"?"增加数量":"减少数量"},{default:o(()=>[a(L,{modelValue:n.value.delta,"onUpdate:modelValue":e[9]||(e[9]=t=>n.value.delta=t),min:1,max:v.value==="increase"?100:n.value.currentSize,style:{width:"100%"}},null,8,["modelValue","max"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{oe as default};
