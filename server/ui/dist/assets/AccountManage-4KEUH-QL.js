import{s as re,p as Z}from"./public-api-BJq2-jLc.js";import{i as D}from"./index-UDkyn1f5.js";import{d as se,r as E,k as ue,l as C,o as de,c as P,a as B,b as n,w as a,e as m,E as s,h as g,n as $,p as h,F,i as K,j as y,q}from"./index-C-CE9rO1.js";function ce(){return D.get("/cloud-provider-option/account")}function S(w){return D.post("/cloud-provider-option/account",w)}function ie(w,p){return D.delete(`/cloud-provider-option/provider/${w}/account/${p}`)}function me(w){return D.delete(`/cloud-provider-option/provider/${w}`)}const pe={class:"page-container"},ve={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"20px"}},fe={style:{display:"flex",gap:"10px"}},ye={style:{padding:"20px"}},be={style:{display:"flex",gap:"10px"}},ke=se({__name:"AccountManage",setup(w){const p=E(""),v=E({}),M=ue(()=>Object.keys(v.value).map(t=>({label:t,value:t}))),x=C({}),u=C({}),c=C({}),_=C({}),j=E(!1),b=C({providerName:""}),N=E(!1),r=C({provider:"",accountName:""}),i=(t,e)=>`${t}:${e}`,T=t=>{const e=v.value[t]||{};return Object.keys(e)},G=t=>{var e;try{(e=u[t])!=null&&e.trim()&&Z(u[t]),c[t]=""}catch(l){c[t]=`YAML 格式错误: ${l.message}`}},H=()=>{Object.keys(u).forEach(e=>delete u[e]),Object.keys(c).forEach(e=>delete c[e]),Object.keys(_).forEach(e=>delete _[e]),Object.keys(x).forEach(e=>delete x[e]);for(const e of Object.keys(v.value)){const l=v.value[e]||{};for(const[f,A]of Object.entries(l)){const k=i(e,f);u[k]=re(A),_[k]=u[k],c[k]=""}const V=Object.keys(l);V.length>0&&(x[e]=V[0])}const t=Object.keys(v.value);t.length>0&&!p.value&&(p.value=t[0])},J=()=>{b.providerName="",j.value=!0},Q=async()=>{if(!b.providerName.trim()){s.warning("请输入云服务商名称");return}if(!/^[a-zA-Z0-9_-]+$/.test(b.providerName)){s.error("云服务商名称只能包含字母、数字、下划线和横线");return}if(v.value[b.providerName]){s.error("云服务商已存在");return}try{await S({[b.providerName]:{}}),s.success("云服务商已添加"),j.value=!1,await O(),p.value=b.providerName}catch(t){s.error(`添加失败: ${t.message||t}`)}},W=async t=>{try{await q.confirm(`确定要删除云服务商 "${t}" 及其下所有账号吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await me(t),s.success("删除成功"),await O()}catch(e){e!=="cancel"&&s.error(`删除失败: ${e.message||e}`)}},X=()=>{r.provider=p.value,r.accountName="",N.value=!0},ee=()=>{if(!r.provider){s.warning("请选择云服务商");return}if(!r.accountName.trim()){s.warning("请输入账号名称");return}if(!/^[a-zA-Z0-9_-]+$/.test(r.accountName)){s.error("账号名称只能包含字母、数字、下划线和横线");return}if(T(r.provider).includes(r.accountName)){s.error("账号名称已存在");return}const e=i(r.provider,r.accountName);u[e]="",c[e]="",_[e]="";const l=v.value[r.provider]||{};l[r.accountName]={},v.value[r.provider]={...l},p.value=r.provider,x[r.provider]=r.accountName,N.value=!1,s.success("账号已添加，请编辑配置后保存")},te=async(t,e)=>{var V;const l=i(t,e);if(!((V=u[l])!=null&&V.trim())){s.warning("请输入账号配置");return}if(c[l]){s.error("YAML 格式错误，请检查后重试");return}try{const f=Z(u[l]),A={...v.value[t],[e]:f};await S({[t]:A}),s.success("保存成功"),_[l]=u[l],await O()}catch(f){s.error(`保存失败: ${f.message||f}`)}},L=async(t,e)=>{try{await q.confirm(`确定要删除账号 "${e}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ie(t,e),s.success("删除成功");const l=i(t,e);delete u[l],delete c[l],delete _[l],await O()}catch(l){l!=="cancel"&&s.error(`删除失败: ${l.message||l}`)}},le=t=>{L(p.value,t)},oe=(t,e)=>{const l=i(t,e);u[l]=_[l]||"",c[l]=""},O=async()=>{try{const{data:t}=await ce();v.value=t.data||{aws:{},ali:{}},H()}catch(t){console.error("加载账号数据失败:",t),s.error("加载账号数据失败")}};return de(()=>{O()}),(t,e)=>{const l=m("el-button"),V=m("el-alert"),f=m("el-input"),A=m("el-tab-pane"),k=m("el-empty"),R=m("el-tabs"),Y=m("el-form-item"),z=m("el-form"),I=m("el-dialog"),ae=m("el-option"),ne=m("el-select");return y(),P("div",pe,[B("div",ve,[e[10]||(e[10]=B("h2",null,"云账号管理",-1)),B("div",fe,[n(l,{type:"success",onClick:J},{default:a(()=>[...e[8]||(e[8]=[g("添加云服务商",-1)])]),_:1}),n(l,{type:"primary",onClick:X},{default:a(()=>[...e[9]||(e[9]=[g("添加账号",-1)])]),_:1})])]),n(R,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),type:"border-card",closable:"",onTabRemove:W},{default:a(()=>[(y(!0),P(F,null,K(M.value,o=>(y(),$(A,{key:o.value,label:o.label,name:o.value},{default:a(()=>[n(R,{modelValue:x[o.value],"onUpdate:modelValue":d=>x[o.value]=d,type:"card",closable:"",onTabRemove:le},{default:a(()=>[(y(!0),P(F,null,K(T(o.value),d=>(y(),$(A,{key:d,label:d,name:d},{default:a(()=>[B("div",ye,[c[i(o.value,d)]?(y(),$(V,{key:0,title:c[i(o.value,d)],type:"error",closable:!1,style:{"margin-bottom":"15px"}},null,8,["title"])):h("",!0),n(f,{modelValue:u[i(o.value,d)],"onUpdate:modelValue":U=>u[i(o.value,d)]=U,type:"textarea",rows:20,placeholder:"请输入 YAML 格式的账号配置",style:{"font-family":"'Courier New', monospace","font-size":"13px","margin-bottom":"15px"},onInput:U=>G(i(o.value,d))},null,8,["modelValue","onUpdate:modelValue","onInput"]),B("div",be,[n(l,{type:"primary",disabled:!!c[i(o.value,d)],onClick:U=>te(o.value,d)},{default:a(()=>[...e[11]||(e[11]=[g(" 保存 ",-1)])]),_:1},8,["disabled","onClick"]),n(l,{onClick:U=>oe(o.value,d)},{default:a(()=>[...e[12]||(e[12]=[g("取消",-1)])]),_:1},8,["onClick"]),n(l,{type:"danger",onClick:U=>L(o.value,d)},{default:a(()=>[...e[13]||(e[13]=[g("删除账号",-1)])]),_:1},8,["onClick"])])])]),_:2},1032,["label","name"]))),128)),T(o.value).length===0?(y(),$(k,{key:0,description:"暂无账号，请添加",style:{padding:"60px 0"}})):h("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","name"]))),128)),M.value.length===0?(y(),$(k,{key:0,description:"暂无云服务商，请添加",style:{padding:"60px 0"}})):h("",!0)]),_:1},8,["modelValue"]),n(I,{modelValue:j.value,"onUpdate:modelValue":e[3]||(e[3]=o=>j.value=o),title:"添加云服务商",width:"500px"},{footer:a(()=>[n(l,{onClick:e[2]||(e[2]=o=>j.value=!1)},{default:a(()=>[...e[14]||(e[14]=[g("取消",-1)])]),_:1}),n(l,{type:"primary",onClick:Q},{default:a(()=>[...e[15]||(e[15]=[g("确定",-1)])]),_:1})]),default:a(()=>[n(z,{model:b,"label-width":"120px"},{default:a(()=>[n(Y,{label:"云服务商名称"},{default:a(()=>[n(f,{modelValue:b.providerName,"onUpdate:modelValue":e[1]||(e[1]=o=>b.providerName=o),placeholder:"请输入云服务商名称（如: aws, ali, tencentcloud）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),n(I,{modelValue:N.value,"onUpdate:modelValue":e[7]||(e[7]=o=>N.value=o),title:"添加账号",width:"500px"},{footer:a(()=>[n(l,{onClick:e[6]||(e[6]=o=>N.value=!1)},{default:a(()=>[...e[16]||(e[16]=[g("取消",-1)])]),_:1}),n(l,{type:"primary",onClick:ee},{default:a(()=>[...e[17]||(e[17]=[g("确定",-1)])]),_:1})]),default:a(()=>[n(z,{model:r,"label-width":"100px"},{default:a(()=>[n(Y,{label:"云服务商"},{default:a(()=>[n(ne,{modelValue:r.provider,"onUpdate:modelValue":e[4]||(e[4]=o=>r.provider=o),placeholder:"请选择云服务商",style:{width:"100%"}},{default:a(()=>[(y(!0),P(F,null,K(M.value,o=>(y(),$(ae,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(Y,{label:"账号名称"},{default:a(()=>[n(f,{modelValue:r.accountName,"onUpdate:modelValue":e[5]||(e[5]=o=>r.accountName=o),placeholder:"请输入账号名称（字母、数字、下划线、横线）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{ke as default};
