import{s as H,p as E}from"./public-api-BJq2-jLc.js";import{i as B}from"./index-UDkyn1f5.js";import{d as J,r as C,k as K,l as x,o as Q,c as T,a as k,b as r,w as s,e as c,E as d,h as v,n as $,p as D,F as W,i as X,j as g,q as M}from"./index-C-CE9rO1.js";function Z(m){return B.get("/cloud-provider-option/instance-parameter",{params:{name:m}})}function N(m){return B.post("/cloud-provider-option/instance-parameter",m)}function ee(m){return B.delete(`/cloud-provider-option/instance-parameter/${m}`)}const te={class:"page-container"},ne={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"20px"}},oe={style:{padding:"20px"}},ae={style:{display:"flex",gap:"10px"}},ie=J({__name:"InstanceParameter",setup(m){const b=C({}),u=C(""),f=K(()=>Object.keys(b.value)),o=x({}),l=x({}),p=x({}),y=C(!1),i=x({parameterName:""}),P=e=>{var t;try{(t=o[e])!=null&&t.trim()&&E(o[e]),l[e]=""}catch(a){l[e]=`YAML 格式错误: ${a.message}`}},Y=()=>{Object.keys(o).forEach(e=>delete o[e]),Object.keys(l).forEach(e=>delete l[e]),Object.keys(p).forEach(e=>delete p[e]);for(const[e,t]of Object.entries(b.value))o[e]=H(t),p[e]=o[e],l[e]="";f.value.length>0?(!u.value||!f.value.includes(u.value))&&(u.value=f.value[0]):u.value=""},h=()=>{i.parameterName="",y.value=!0},A=()=>{if(!i.parameterName.trim()){d.warning("请输入参数名称");return}if(f.value.includes(i.parameterName)){d.error("参数名称已存在");return}o[i.parameterName]="",l[i.parameterName]="",p[i.parameterName]="",b.value[i.parameterName]={},u.value=i.parameterName,y.value=!1,d.success("参数已添加，请编辑配置后保存")},O=async e=>{var t;if(!((t=o[e])!=null&&t.trim())){d.warning("请输入参数配置");return}if(l[e]){d.error("YAML 格式错误，请检查后重试");return}try{await M.confirm("确定要保存此参数配置吗？","保存确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=E(o[e]),V={[e]:a};await N(V),d.success("保存成功"),p[e]=o[e],await w()}catch(a){a!=="cancel"&&d.error(`保存失败: ${a.message||a}`)}},I=async e=>{try{await M.confirm(`确定要删除参数 "${e}" 吗？此操作不可恢复！`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ee(e),d.success("删除成功"),delete o[e],delete l[e],delete p[e],await w()}catch(t){t!=="cancel"&&d.error(`删除失败: ${t.message||t}`)}},U=e=>{I(e)},L=e=>{o[e]=p[e]||"",l[e]=""},w=async()=>{try{const{data:e}=await Z();b.value=e.data||{},Y()}catch(e){console.error("加载参数失败:",e),d.error("加载参数失败")}};return Q(()=>{w()}),(e,t)=>{const a=c("el-button"),V=c("el-alert"),j=c("el-input"),F=c("el-tab-pane"),R=c("el-empty"),q=c("el-tabs"),z=c("el-form-item"),S=c("el-form"),G=c("el-dialog");return g(),T("div",te,[k("div",ne,[t[5]||(t[5]=k("h2",null,"Instance 参数管理",-1)),r(a,{type:"primary",onClick:h},{default:s(()=>[...t[4]||(t[4]=[v("添加参数",-1)])]),_:1})]),r(q,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=n=>u.value=n),type:"card",closable:"",onTabRemove:U},{default:s(()=>[(g(!0),T(W,null,X(f.value,n=>(g(),$(F,{key:n,label:n,name:n},{default:s(()=>[k("div",oe,[l[n]?(g(),$(V,{key:0,title:l[n],type:"error",closable:!1,style:{"margin-bottom":"15px"}},null,8,["title"])):D("",!0),r(j,{modelValue:o[n],"onUpdate:modelValue":_=>o[n]=_,type:"textarea",rows:20,placeholder:"请输入 YAML 格式的参数配置",style:{"font-family":"'Courier New', monospace","font-size":"13px","margin-bottom":"15px"},onInput:_=>P(n)},null,8,["modelValue","onUpdate:modelValue","onInput"]),k("div",ae,[r(a,{type:"primary",disabled:!!l[n],onClick:_=>O(n)},{default:s(()=>[...t[6]||(t[6]=[v(" 保存 ",-1)])]),_:1},8,["disabled","onClick"]),r(a,{onClick:_=>L(n)},{default:s(()=>[...t[7]||(t[7]=[v("取消",-1)])]),_:1},8,["onClick"]),r(a,{type:"danger",onClick:_=>I(n)},{default:s(()=>[...t[8]||(t[8]=[v("删除参数",-1)])]),_:1},8,["onClick"])])])]),_:2},1032,["label","name"]))),128)),f.value.length===0?(g(),$(R,{key:0,description:"暂无 Instance 参数，请添加",style:{padding:"60px 0"}})):D("",!0)]),_:1},8,["modelValue"]),r(G,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=n=>y.value=n),title:"添加 Instance 参数",width:"500px"},{footer:s(()=>[r(a,{onClick:t[2]||(t[2]=n=>y.value=!1)},{default:s(()=>[...t[9]||(t[9]=[v("取消",-1)])]),_:1}),r(a,{type:"primary",onClick:A},{default:s(()=>[...t[10]||(t[10]=[v("确定",-1)])]),_:1})]),default:s(()=>[r(S,{model:i,"label-width":"100px"},{default:s(()=>[r(z,{label:"参数名称"},{default:s(()=>[r(j,{modelValue:i.parameterName,"onUpdate:modelValue":t[1]||(t[1]=n=>i.parameterName=n),placeholder:"请输入参数名称（如：tencentcloud_beijing5_10-2-13-x）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{ie as default};
